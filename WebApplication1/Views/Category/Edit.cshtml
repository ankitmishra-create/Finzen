@model FinanceManagement.Application.ViewModels.AddCategoryVM
@using FinanceManagement.Core.Enums

@{
    var categoryTypes = Enum.GetValues(typeof(CategoryType))
                            .Cast<CategoryType>()
                            .Select(e => new SelectListItem { Value = ((int)e).ToString(), Text = e.ToString() })
                            .ToList();

    var investmentSubtypes = Enum.GetValues(typeof(SubType))
                                 .Cast<SubType>()
                                 .Select(e => new SelectListItem { Value = ((int)e).ToString(), Text = e.ToString() })
                                 .ToList();
}

<div class="card p-4 shadow">
    <h2>Add Category</h2>

    <form asp-controller="Category" asp-action="Edit" method="post">
        <input hidden asp-for="Id" "  />
        <div class="mb-3">
            <label asp-for="CategoryName" class="form-label"></label>
            <input asp-for="CategoryName" class="form-control" />
            <span asp-validation-for="CategoryName" class="text-danger small"></span>
        </div>

        <div class="mb-3">
            <label asp-for="CategoryType" class="form-label"></label>
            <select asp-for="CategoryType" class="form-select" asp-items="categoryTypes" id="categoryTypeDropdown"></select>
            <span asp-validation-for="CategoryType" class="text-danger small"></span>
        </div>

        <div class="mb-3" id="subtypeContainer" style="display:none;">
            <label asp-for="SubType" class="form-label"></label>
            <select asp-for="SubType" class="form-select" asp-items="investmentSubtypes"></select>
            <span asp-validation-for="SubType" class="text-danger small"></span>
        </div>

        <button type="submit" class="btn btn-primary">Save</button>
    </form>
</div>

@section Scripts {
    <script>
        const categoryTypeDropdown = document.getElementById("categoryTypeDropdown");
        const subtypeContainer = document.getElementById("subtypeContainer");

        function toggleSubtype() {
            if (categoryTypeDropdown.value === "3") { // 3 = Investment
                subtypeContainer.style.display = "block";
            } else {
                subtypeContainer.style.display = "none";
            }
        }

        categoryTypeDropdown.addEventListener("change", toggleSubtype);
        toggleSubtype(); // run on page load
    </script>
}
