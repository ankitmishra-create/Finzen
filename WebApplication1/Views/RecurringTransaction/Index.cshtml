@using FinanceManagement.Core.Entities
@using FinanceManagement.Core.Enums
@model List<RecurringTransactions>

@{
    ViewData["Title"] = "Recurring Transactions";
}

<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
        <h1 class="text-3xl font-semibold text-gray-800">Recurring Transactions</h1>
        <a asp-action="Create" asp-controller="Transaction"
           class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-xl shadow-sm transition-all duration-200">
            <i class="fas fa-plus mr-2"></i> Add New
        </a>
    </div>

    @if (Model != null && Model.Any(r => r.IsActive))
    {
        <div class="bg-white rounded-2xl shadow-md overflow-hidden border border-gray-100">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-100 text-sm">
                    <thead class="bg-gray-50">
                        <tr class="text-left text-gray-700 uppercase tracking-wider text-xs">
                            <th class="px-6 py-3">Category Type</th>
                            <th class="px-6 py-3">Amount</th>
                            <th class="px-6 py-3">Category</th>
                            <th class="px-6 py-3">Frequency</th>
                            <th class="px-6 py-3">Next Transaction</th>
                            <th class="px-6 py-3 text-right">Actions</th>
                        </tr>
                    </thead>

                    <tbody class="divide-y divide-gray-100 bg-white">
                        @foreach (var recurring in Model)
                        {
                            if (recurring.IsActive)
                            {
                                <tr class="hover:bg-gray-50 transition-colors duration-150">
                                    <td class="px-6 py-4 font-semibold @(recurring.Category?.CategoryType == CategoryType.Income ? "text-green-600" : "text-red-600")">
                                        @recurring.Category?.CategoryType
                                    </td>

                                    <td class="px-6 py-4">
                                        <span class="font-medium @(recurring.Amount >= 0 ? "text-green-700" : "text-red-700")">
                                            @ViewBag.CurrencySymbol @recurring.Amount
                                        </span>
                                    </td>

                                    <td class="px-6 py-4">
                                        <span class="inline-flex items-center px-3 py-1 text-xs font-medium rounded-full
                                                           bg-gray-100 text-gray-800 border border-gray-200">
                                            @(recurring.Category?.CategoryName ?? "N/A")
                                        </span>
                                    </td>

                                    <td class="px-6 py-4 text-gray-700">@recurring.Frequency</td>

                                    <td class="px-6 py-4 text-gray-700">
                                        @recurring.NextTransactionDate?.ToString("MMM dd, yyyy")
                                    </td>

                                    <td class="px-6 py-4 text-right">
                                        <div class="flex justify-end gap-3">
                                            <a asp-action="Edit"
                                               asp-controller="RecurringTransaction"
                                               asp-route-recurringTransactionId="@recurring.RecurringTransactionId"
                                               class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-indigo-600 border border-indigo-200 hover:bg-indigo-50 rounded-lg transition-all duration-150">
                                                <i class="fas fa-pencil-alt mr-1"></i> Edit
                                            </a>

                                            <form asp-action="Delete"
                                                  asp-controller="RecurringTransaction"
                                                  asp-route-recurringTransactionId="@recurring.RecurringTransactionId"
                                                  method="post">
                                                <button type="submit"
                                                        class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-red-600 border border-red-200 hover:bg-red-50 rounded-lg transition-all duration-150">
                                                    <i class="fas fa-trash-alt mr-1"></i> Delete
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div class="text-center bg-white rounded-2xl border border-gray-200 shadow-sm p-10 mt-6">
            <div class="flex flex-col items-center space-y-4">
                <i class="fas fa-folder-open fa-3x text-gray-400"></i>
                <h4 class="text-lg font-semibold text-gray-800">No Recurring Transactions Found</h4>
                <p class="text-gray-500 text-sm max-w-md">
                    Get started by adding a new recurring transaction to track your regular income or expenses.
                </p>
                <a asp-action="Create"
                   asp-controller="Transaction"
                   class="inline-flex items-center px-5 py-2 text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 rounded-xl shadow-sm transition-all duration-200">
                    <i class="fas fa-plus mr-2"></i>Add Your First One
                </a>
            </div>
        </div>
    }
</div>
